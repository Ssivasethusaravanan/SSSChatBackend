{"version":3,"file":"index.js","sourceRoot":"","sources":["../../../src/utils/index.ts"],"names":[],"mappings":"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","sourcesContent":["import type { Address, Hash, Hex } from \"viem\";\nimport { encodeAbiParameters, hexToBigInt, keccak256, toHex } from \"viem\";\nimport * as chains from \"viem/chains\";\nimport type { PromiseOrValue, UserOperationRequest } from \"../types.js\";\n\n/**\n * Utility method for converting a chainId to a {@link chains.Chain} object\n *\n * @param chainId\n * @returns a {@link chains.Chain} object for the given chainId\n * @throws if the chainId is not found\n */\nexport const getChain = (chainId: number): chains.Chain => {\n  for (const chain of Object.values(chains)) {\n    if (chain.id === chainId) {\n      return chain;\n    }\n  }\n  throw new Error(\"could not find chain\");\n};\n\n/**\n * Utility function that allows for piping a series of async functions together\n *\n * @param fns - functions to pipe\n * @returns result of the pipe\n */\nexport const asyncPipe =\n  <T>(...fns: ((x: T) => Promise<T>)[]) =>\n  async (x: T) => {\n    let result = x;\n    for (const fn of fns) {\n      result = await fn(result);\n    }\n    return result;\n  };\n\n// based on @ethersproject/properties, but pulled in here to minize the dependency on ethers\nexport type Deferrable<T> = {\n  [K in keyof T]: PromiseOrValue<T[K]>;\n};\n\n/**\n * Await all of the properties of a {@link Deferrable} object\n *\n * @param object - a {@link Deferrable} object\n * @returns the object with its properties resolved\n */\nexport async function resolveProperties<T>(object: Deferrable<T>): Promise<T> {\n  const promises = Object.keys(object).map((key) => {\n    const value = object[key as keyof Deferrable<T>];\n    return Promise.resolve(value).then((v) => ({ key: key, value: v }));\n  });\n\n  const results = await Promise.all(promises);\n\n  return results.reduce((accum, curr) => {\n    accum[curr.key as keyof T] = curr.value;\n    return accum;\n  }, {} as T);\n}\n\n/**\n * Recursively converts all values in an object to hex strings\n *\n * @param obj - obj to deep hexlify\n * @returns object with all of its values hexlified\n */\nexport function deepHexlify(obj: any): any {\n  if (typeof obj === \"function\") {\n    return undefined;\n  }\n  if (obj == null || typeof obj === \"string\" || typeof obj === \"boolean\") {\n    return obj;\n  } else if (typeof obj === \"bigint\") {\n    return toHex(obj);\n  } else if (obj._isBigNumber != null || typeof obj !== \"object\") {\n    return toHex(obj).replace(/^0x0/, \"0x\");\n  }\n  if (Array.isArray(obj)) {\n    return obj.map((member) => deepHexlify(member));\n  }\n  return Object.keys(obj).reduce(\n    (set, key) => ({\n      ...set,\n      [key]: deepHexlify(obj[key]),\n    }),\n    {}\n  );\n}\n\n/**\n * Generates a hash for a UserOperation valid from entrypoint version 0.6 onwards\n *\n * @param request - the UserOperation to get the hash for\n * @param entryPointAddress - the entry point address that will be used to execute the UserOperation\n * @param chainId - the chain on which this UserOperation will be executed\n * @returns the hash of the UserOperation\n */\nexport function getUserOperationHash(\n  request: UserOperationRequest,\n  entryPointAddress: Address,\n  chainId: bigint\n): Hash {\n  const encoded = encodeAbiParameters(\n    [{ type: \"bytes32\" }, { type: \"address\" }, { type: \"uint256\" }],\n    [keccak256(packUo(request)), entryPointAddress, chainId]\n  ) as `0x${string}`;\n\n  return keccak256(encoded);\n}\n\nfunction packUo(request: UserOperationRequest): Hex {\n  const hashedInitCode = keccak256(request.initCode);\n  const hashedCallData = keccak256(request.callData);\n  const hashedPaymasterAndData = keccak256(request.paymasterAndData);\n\n  return encodeAbiParameters(\n    [\n      { type: \"address\" },\n      { type: \"uint256\" },\n      { type: \"bytes32\" },\n      { type: \"bytes32\" },\n      { type: \"uint256\" },\n      { type: \"uint256\" },\n      { type: \"uint256\" },\n      { type: \"uint256\" },\n      { type: \"uint256\" },\n      { type: \"bytes32\" },\n    ],\n    [\n      request.sender as Address,\n      hexToBigInt(request.nonce),\n      hashedInitCode,\n      hashedCallData,\n      hexToBigInt(request.callGasLimit),\n      hexToBigInt(request.verificationGasLimit),\n      hexToBigInt(request.preVerificationGas),\n      hexToBigInt(request.maxFeePerGas),\n      hexToBigInt(request.maxPriorityFeePerGas),\n      hashedPaymasterAndData,\n    ]\n  );\n}\n\n// borrowed from ethers.js\nexport function defineReadOnly<T, K extends keyof T>(\n  object: T,\n  key: K,\n  value: T[K]\n): void {\n  Object.defineProperty(object, key, {\n    enumerable: true,\n    value: value,\n    writable: false,\n  });\n}\n\nexport * from \"./bigint.js\";\nexport * from \"./defaults.js\";\nexport * from \"./schema.js\";\nexport * from \"./userop.js\";\n"]}